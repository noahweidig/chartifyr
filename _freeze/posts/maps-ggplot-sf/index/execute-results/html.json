{
  "hash": "8b6dac27cb0ef6f59832398f41209e86",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Mapping with ggplot2 and sf\"\nsubtitle: \"A simple guide to creating elegant maps in R\"\nexecute:\n  warning: false\nauthor: \"Noah Weidig\"\ndate: \"2025-02-14\"\ncategories: [code, ggplot2, dataviz, sf]\nimage: \"image.jpg\"\n---\n\n\n\n[![Artwork by \\@allison_horst](https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F077ba65d-1d4e-431d-b719-bda847313d1a_1485x1122.jpeg)](https://twitter.com/allison_horst)\n\nHave you ever made a map in ArcGIS, only to later realize that you made a mistake with your data and will have to remake the entire thing? That's where the `sf` package in R comes in!\n\nLet’s load the sf and tidyverse packages.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Uncomment and run this only once\n#install.packages(\"sf\")\nlibrary(sf)\nlibrary(tidyverse)\n```\n:::\n\n\n\nNow, we’ll need to load our data. We’ll use the North Carolina counties data built into the sf package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnc <- st_read(system.file(\"shape/nc.shp\", package = \"sf\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `nc' from data source \n  `/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/sf/shape/nc.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 100 features and 14 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965\nGeodetic CRS:  NAD27\n```\n\n\n:::\n:::\n\n\n\nEvery sf object has a “geometry” column, which stores the coordinates of the point, line, or polygon. Now, let’s plot it. The ggplot2 package has a geom_sf option for simple features.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + geom_sf(data = nc)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# if that does not work, you may have to specify the geometry in the aesthetic\nggplot() + geom_sf(data = nc, aes(geometry = geometry))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::\n\n\n\nNot bad. I prefer to not see the latitude/longitude along the axes, so I frequently use `theme_void()`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + geom_sf(data = nc) + theme_void()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\nGreat! This dataset has several attributes related to births and infant deaths. We’ll use the SID79, which is the number of sudden infant deaths in the year 1979 for each county.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + geom_sf(data = nc, aes(fill = SID79)) + theme_void()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\nThe ggplot default colors are not my favorite. I prefer using brewer colors. The direction argument reverses the direction of color darkening so that darker indicates a higher value.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + geom_sf(data = nc, aes(fill = SID79)) + theme_void() +\n  scale_fill_distiller(palette = \"YlOrBr\", direction = 1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\nWe can see quite clearly that a few counties in central North Carolina had a large number of sudden infant deaths in 1979. To clean up this map, let’s add a scale bar and north arrow (using the ggspatial package), and refine the labels.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggspatial)\n\nggplot() +\n  geom_sf(data = nc, aes(fill = SID79)) +\n  theme_void() +\n  scale_fill_distiller(palette = \"YlOrBr\", direction = 1) +\n  annotation_scale(location = \"bl\", line_width = 1) +\n  annotation_north_arrow(style = north_arrow_fancy_orienteering(),\n                         location = \"tl\", \n                         height = unit(0.8, \"cm\"),\n                         width = unit(0.8, \"cm\")) +\n  labs(fill = \"SIDS 1979\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\nMuch better! The scale bar and north arrow size can be adjusted as needed. This mostly depends on how large you save the figure. These ggplot objects can be saved the same way as a regular plot.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"nc.jpg\", width = 5, height = 3, dpi = 300)\n```\n:::\n\n\n\nAnd you’re done! You’ve created your first official map in R!\n\nThanks for joining me. Keep an eye out for more tutorials in R!\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}